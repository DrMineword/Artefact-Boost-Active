Ly8gQ3JlYXRlIGEgY2FudmFzIGZvciBzbm93IHRoYXQgc2l0cyBvbiB0b3Agb2YgZXZlcnl0aGluZwpjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKY2FudmFzLnN0eWxlLnBvc2l0aW9uID0gJ2ZpeGVkJzsKY2FudmFzLnN0eWxlLnRvcCA9ICcwJzsKY2FudmFzLnN0eWxlLmxlZnQgPSAnMCc7CmNhbnZhcy5zdHlsZS53aWR0aCA9ICcxMDAlJzsKY2FudmFzLnN0eWxlLmhlaWdodCA9ICcxMDAlJzsKY2FudmFzLnN0eWxlLnBvaW50ZXJFdmVudHMgPSAnbm9uZSc7IC8vIEVuc3VyZSB0aGUgY2FudmFzIGRvZXNuJ3QgYmxvY2sgaW50ZXJhY3Rpb25zCmNhbnZhcy5zdHlsZS56SW5kZXggPSAnOTk5OSc7IC8vIEFsd2F5cyBvbiB0b3AKZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjYW52YXMpOwoKY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7CgpsZXQgd2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDsKbGV0IGhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDsKY2FudmFzLndpZHRoID0gd2lkdGg7CmNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7Cgpjb25zdCBzbm93Zmxha2VzID0gW107CmxldCBzbm93U2V0dGluZ3MgPSB7CiAgc25vd2ZsYWtlQ291bnQ6IDE1MCwgLy8gRGVmYXVsdCB2YWx1ZXMKICBtaW5TaXplOiAyLAogIG1heFNpemU6IDUsCiAgc3BlZWQ6IDIsCiAgbGlnaHRUaHJlc2hvbGQ6IDIwMCwKfTsKCi8vIEZldGNoIEpTT04gc2V0dGluZ3MKZmV0Y2goJ2h0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9Eck1pbmV3b3JkL0FydGVmYWN0LUJvb3N0LUFjdGl2ZS9yZWZzL2hlYWRzL21haW4vc25vd3kuanNvbicpCiAgLnRoZW4oKHJlc3BvbnNlKSA9PiByZXNwb25zZS5qc29uKCkpCiAgLnRoZW4oKGRhdGEpID0-IHsKICAgIHNub3dTZXR0aW5ncyA9IHsgLi4uc25vd1NldHRpbmdzLCAuLi5kYXRhIH07CiAgICBjcmVhdGVTbm93Zmxha2VzKCk7IC8vIEluaXRpYWxpemUgc25vd2ZsYWtlcyBhZnRlciBmZXRjaGluZyBzZXR0aW5ncwogIH0pCiAgLmNhdGNoKChlcnJvcikgPT4gewogICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGxvYWQgc25vdyBzZXR0aW5nczonLCBlcnJvcik7CiAgICBjcmVhdGVTbm93Zmxha2VzKCk7IC8vIEZhbGxiYWNrIHRvIGRlZmF1bHQgc2V0dGluZ3MKICB9KTsKCi8vIFV0aWxpdHkgZnVuY3Rpb24gdG8gY2hlY2sgYnJpZ2h0bmVzcyBvZiB0aGUgYmFja2dyb3VuZCB1bmRlciBhIHNub3dmbGFrZQpmdW5jdGlvbiBpc0xpZ2h0QmFja2dyb3VuZCh4LCB5KSB7CiAgY29uc3QgaW1hZ2VEYXRhID0gY3R4LmdldEltYWdlRGF0YSh4LCB5LCAxLCAxKS5kYXRhOwogIGNvbnN0IGJyaWdodG5lc3MgPSAoaW1hZ2VEYXRhWzBdICsgaW1hZ2VEYXRhWzFdICsgaW1hZ2VEYXRhWzJdKSAvIDM7IC8vIEF2ZXJhZ2UgUkdCCiAgcmV0dXJuIGJyaWdodG5lc3MgPiBzbm93U2V0dGluZ3MubGlnaHRUaHJlc2hvbGQ7Cn0KCi8vIFNub3dmbGFrZSBjbGFzcwpjbGFzcyBTbm93Zmxha2UgewogIGNvbnN0cnVjdG9yKCkgewogICAgdGhpcy5yZXNldCgpOwogIH0KCiAgcmVzZXQoKSB7CiAgICB0aGlzLnggPSBNYXRoLnJhbmRvbSgpICogd2lkdGg7CiAgICB0aGlzLnkgPSBNYXRoLnJhbmRvbSgpICogaGVpZ2h0OwogICAgdGhpcy5yYWRpdXMgPSBNYXRoLnJhbmRvbSgpICogKHNub3dTZXR0aW5ncy5tYXhTaXplIC0gc25vd1NldHRpbmdzLm1pblNpemUpICsgc25vd1NldHRpbmdzLm1pblNpemU7CiAgICB0aGlzLnNwZWVkWCA9IE1hdGgucmFuZG9tKCkgKiAyIC0gMTsKICAgIHRoaXMuc3BlZWRZID0gTWF0aC5yYW5kb20oKSAqIHNub3dTZXR0aW5ncy5zcGVlZCArIDAuNTsKICB9CgogIHVwZGF0ZSgpIHsKICAgIHRoaXMueCArPSB0aGlzLnNwZWVkWDsKICAgIHRoaXMueSArPSB0aGlzLnNwZWVkWTsKCiAgICBpZiAodGhpcy54ID4gd2lkdGgpIHRoaXMueCA9IDA7CiAgICBpZiAodGhpcy54IDwgMCkgdGhpcy54ID0gd2lkdGg7CiAgICBpZiAodGhpcy55ID4gaGVpZ2h0KSB0aGlzLnkgPSAwOwogIH0KCiAgZHJhdygpIHsKICAgIGNvbnN0IG91dGxpbmUgPSBpc0xpZ2h0QmFja2dyb3VuZCh0aGlzLngsIHRoaXMueSkgPyAnYmxhY2snIDogJ3RyYW5zcGFyZW50JzsKCiAgICBjdHguYmVnaW5QYXRoKCk7CiAgICBjdHguYXJjKHRoaXMueCwgdGhpcy55LCB0aGlzLnJhZGl1cywgMCwgTWF0aC5QSSAqIDIpOwogICAgY3R4LmZpbGxTdHlsZSA9ICd3aGl0ZSc7CiAgICBjdHguZmlsbCgpOwogICAgaWYgKG91dGxpbmUgIT09ICd0cmFuc3BhcmVudCcpIHsKICAgICAgY3R4LnN0cm9rZVN0eWxlID0gb3V0bGluZTsKICAgICAgY3R4LmxpbmVXaWR0aCA9IDAuNTsKICAgICAgY3R4LnN0cm9rZSgpOwogICAgfQogICAgY3R4LmNsb3NlUGF0aCgpOwogIH0KfQoKLy8gSW5pdGlhbGl6ZSBzbm93Zmxha2VzCmZ1bmN0aW9uIGNyZWF0ZVNub3dmbGFrZXMoKSB7CiAgc25vd2ZsYWtlcy5sZW5ndGggPSAwOyAvLyBDbGVhciBleGlzdGluZyBzbm93Zmxha2VzCiAgZm9yIChsZXQgaSA9IDA7IGkgPCBzbm93U2V0dGluZ3Muc25vd2ZsYWtlQ291bnQ7IGkrKykgewogICAgc25vd2ZsYWtlcy5wdXNoKG5ldyBTbm93Zmxha2UoKSk7CiAgfQp9CgovLyBSZXNpemUgY2FudmFzIG9uIHdpbmRvdyByZXNpemUKd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsICgpID0-IHsKICB3aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoOwogIGhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDsKICBjYW52YXMud2lkdGggPSB3aWR0aDsKICBjYW52YXMuaGVpZ2h0ID0gaGVpZ2h0OwogIGNyZWF0ZVNub3dmbGFrZXMoKTsgLy8gUmVjcmVhdGUgc25vd2ZsYWtlcyB0byBmaXQgdGhlIG5ldyBzaXplCn0pOwoKLy8gQW5pbWF0aW9uIGxvb3AKZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICBjdHguY2xlYXJSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogIHNub3dmbGFrZXMuZm9yRWFjaCgoc25vd2ZsYWtlKSA9PiB7CiAgICBzbm93Zmxha2UudXBkYXRlKCk7CiAgICBzbm93Zmxha2UuZHJhdygpOwogIH0pOwogIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKfQoKLy8gU3RhcnQgYW5pbWF0aW9uCmFuaW1hdGUoKTs
