const canvas = document.createElement('canvas');
document.body.appendChild(canvas);
const ctx = canvas.getContext('2d');

let width = window.innerWidth;
let height = window.innerHeight;
canvas.width = width;
canvas.height = height;

const snowflakes = [];
const snowflakeCount = 150; // Number of snowflakes
const lightThreshold = 190; // Brightness threshold for outlines

// Utility function to check brightness of the background under a snowflake
function isLightBackground(x, y) {
  const imageData = ctx.getImageData(x, y, 1, 1).data;
  const brightness = (imageData[0] + imageData[1] + imageData[2]) / 3; // Average RGB
  return brightness > lightThreshold;
}

// Snowflake class
class Snowflake {
  constructor() {
    this.x = Math.random() * width;
    this.y = Math.random() * height;
    this.radius = Math.random() * 3 + 1;
    this.speedX = Math.random() * 2 - 1;
    this.speedY = Math.random() * 2 + 1;
  }

  update() {
    this.x += this.speedX;
    this.y += this.speedY;

    if (this.x > width) this.x = 0;
    if (this.x < 0) this.x = width;
    if (this.y > height) this.y = 0;
  }

  draw() {
    const outline = isLightBackground(this.x, this.y) ? 'black' : 'transparent';

    ctx.beginPath();
    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
    ctx.fillStyle = 'white';
    ctx.fill();
    if (outline !== 'transparent') {
      ctx.strokeStyle = outline;
      ctx.lineWidth = 0.5;
      ctx.stroke();
    }
    ctx.closePath();
  }
}

// Initialize snowflakes
function createSnowflakes() {
  for (let i = 0; i < snowflakeCount; i++) {
    snowflakes.push(new Snowflake());
  }
}

// Resize canvas on window resize
window.addEventListener('resize', () => {
  width = window.innerWidth;
  height = window.innerHeight;
  canvas.width = width;
  canvas.height = height;
});

// Animation loop
function animate() {
  ctx.clearRect(0, 0, width, height);
  snowflakes.forEach((snowflake) => {
    snowflake.update();
    snowflake.draw();
  });
  requestAnimationFrame(animate);
}

// Start snow effect
createSnowflakes();
animate();