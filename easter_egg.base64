Ly8gQ3JlYXRlIGEgY2FudmFzIGZvciBzbm93IHRoYXQgc2l0cyBvbiB0b3Agb2YgZXZlcnl0aGluZwpjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKY2FudmFzLnN0eWxlLnBvc2l0aW9uID0gJ2ZpeGVkJzsKY2FudmFzLnN0eWxlLnRvcCA9ICcwJzsKY2FudmFzLnN0eWxlLmxlZnQgPSAnMCc7CmNhbnZhcy5zdHlsZS53aWR0aCA9ICcxMDAlJzsKY2FudmFzLnN0eWxlLmhlaWdodCA9ICcxMDAlJzsKY2FudmFzLnN0eWxlLnBvaW50ZXJFdmVudHMgPSAnbm9uZSc7IC8vIEVuc3VyZSB0aGUgY2FudmFzIGRvZXNuJ3QgYmxvY2sgaW50ZXJhY3Rpb25zCmNhbnZhcy5zdHlsZS56SW5kZXggPSAnOTk5OSc7IC8vIEFsd2F5cyBvbiB0b3AKZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjYW52YXMpOwoKY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7CmxldCB3aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoOwpsZXQgaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0OwpjYW52YXMud2lkdGggPSB3aWR0aDsKY2FudmFzLmhlaWdodCA9IGhlaWdodDsKCmxldCBzbm93Zmxha2VzID0gW107CmxldCBzbm93U2V0dGluZ3MgPSB7CiAgc25vd2ZsYWtlQ291bnQ6IDEwMCwKICBtaW5TaXplOiAxLAogIG1heFNpemU6IDMsCiAgc3BlZWQ6IDEsCiAgbGlnaHRUaHJlc2hvbGQ6IDE5MCwgLy8gQnJpZ2h0bmVzcyB0aHJlc2hvbGQgZm9yIG91dGxpbmVzCn07CgovLyBGZXRjaCBzZXR0aW5ncyBmcm9tIGV4dGVybmFsIEpTT04KZmV0Y2goJ2h0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9Eck1pbmV3b3JkL0FydGVmYWN0LUJvb3N0LUFjdGl2ZS9yZWZzL2hlYWRzL21haW4vc25vd3kuanNvbicpCiAgLnRoZW4oKHJlc3BvbnNlKSA9PiByZXNwb25zZS5qc29uKCkpCiAgLnRoZW4oKGRhdGEpID0-IHsKICAgIHNub3dTZXR0aW5ncyA9IHsgLi4uc25vd1NldHRpbmdzLCAuLi5kYXRhIH07CiAgICBjcmVhdGVTbm93Zmxha2VzKCk7CiAgfSkKICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gbG9hZCBzbm93IHNldHRpbmdzOicsIGVycm9yKTsKICAgIGNyZWF0ZVNub3dmbGFrZXMoKTsgLy8gVXNlIGRlZmF1bHQgc2V0dGluZ3MgaWYgZmV0Y2ggZmFpbHMKICB9KTsKCi8vIFV0aWxpdHkgZnVuY3Rpb24gdG8gY2hlY2sgYnJpZ2h0bmVzcyBvZiB0aGUgYmFja2dyb3VuZCB1bmRlciBhIHNub3dmbGFrZQpmdW5jdGlvbiBpc0xpZ2h0QmFja2dyb3VuZCh4LCB5KSB7CiAgY29uc3QgaW1hZ2VEYXRhID0gY3R4LmdldEltYWdlRGF0YSh4LCB5LCAxLCAxKS5kYXRhOwogIGNvbnN0IGJyaWdodG5lc3MgPSAoaW1hZ2VEYXRhWzBdICsgaW1hZ2VEYXRhWzFdICsgaW1hZ2VEYXRhWzJdKSAvIDM7IC8vIEF2ZXJhZ2UgUkdCCiAgcmV0dXJuIGJyaWdodG5lc3MgPiBzbm93U2V0dGluZ3MubGlnaHRUaHJlc2hvbGQ7Cn0KCi8vIFNub3dmbGFrZSBjbGFzcwpjbGFzcyBTbm93Zmxha2UgewogIGNvbnN0cnVjdG9yKCkgewogICAgdGhpcy5yZXNldCgpOwogIH0KCiAgcmVzZXQoKSB7CiAgICB0aGlzLnggPSBNYXRoLnJhbmRvbSgpICogd2lkdGg7CiAgICB0aGlzLnkgPSBNYXRoLnJhbmRvbSgpICogaGVpZ2h0OwogICAgdGhpcy5yYWRpdXMgPSBNYXRoLnJhbmRvbSgpICogKHNub3dTZXR0aW5ncy5tYXhTaXplIC0gc25vd1NldHRpbmdzLm1pblNpemUpICsgc25vd1NldHRpbmdzLm1pblNpemU7CiAgICB0aGlzLnNwZWVkWCA9IE1hdGgucmFuZG9tKCkgKiAyIC0gMTsKICAgIHRoaXMuc3BlZWRZID0gTWF0aC5yYW5kb20oKSAqIHNub3dTZXR0aW5ncy5zcGVlZCArIDAuNTsKICB9CgogIHVwZGF0ZSgpIHsKICAgIHRoaXMueCArPSB0aGlzLnNwZWVkWDsKICAgIHRoaXMueSArPSB0aGlzLnNwZWVkWTsKCiAgICBpZiAodGhpcy54ID4gd2lkdGggfHwgdGhpcy54IDwgMCB8fCB0aGlzLnkgPiBoZWlnaHQpIHsKICAgICAgdGhpcy5yZXNldCgpOyAvLyBSZXNldCBzbm93Zmxha2UgcG9zaXRpb24gd2hlbiBpdCBnb2VzIG91dCBvZiBib3VuZHMKICAgICAgdGhpcy55ID0gLXRoaXMucmFkaXVzOyAvLyBTdGFydCBmcm9tIHRoZSB0b3AKICAgIH0KICB9CgogIGRyYXcoKSB7CiAgICBjb25zdCBvdXRsaW5lID0gaXNMaWdodEJhY2tncm91bmQodGhpcy54LCB0aGlzLnkpID8gJ2JsYWNrJyA6ICd0cmFuc3BhcmVudCc7CgogICAgY3R4LmJlZ2luUGF0aCgpOwogICAgY3R4LmFyYyh0aGlzLngsIHRoaXMueSwgdGhpcy5yYWRpdXMsIDAsIE1hdGguUEkgKiAyKTsKICAgIGN0eC5maWxsU3R5bGUgPSAnd2hpdGUnOwogICAgY3R4LmZpbGwoKTsKICAgIGlmIChvdXRsaW5lICE9PSAndHJhbnNwYXJlbnQnKSB7CiAgICAgIGN0eC5zdHJva2VTdHlsZSA9IG91dGxpbmU7CiAgICAgIGN0eC5saW5lV2lkdGggPSAwLjU7CiAgICAgIGN0eC5zdHJva2UoKTsKICAgIH0KICAgIGN0eC5jbG9zZVBhdGgoKTsKICB9Cn0KCi8vIEluaXRpYWxpemUgc25vd2ZsYWtlcwpmdW5jdGlvbiBjcmVhdGVTbm93Zmxha2VzKCkgewogIHNub3dmbGFrZXMgPSBbXTsKICBmb3IgKGxldCBpID0gMDsgaSA8IHNub3dTZXR0aW5ncy5zbm93Zmxha2VDb3VudDsgaSsrKSB7CiAgICBzbm93Zmxha2VzLnB1c2gobmV3IFNub3dmbGFrZSgpKTsKICB9Cn0KCi8vIFJlc2l6ZSBjYW52YXMgb24gd2luZG93IHJlc2l6ZQp3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgKCkgPT4gewogIHdpZHRoID0gd2luZG93LmlubmVyV2lkdGg7CiAgaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0OwogIGNhbnZhcy53aWR0aCA9IHdpZHRoOwogIGNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7Cn0pOwoKLy8gQW5pbWF0aW9uIGxvb3AKZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICBjdHguY2xlYXJSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogIHNub3dmbGFrZXMuZm9yRWFjaCgoc25vd2ZsYWtlKSA9PiB7CiAgICBzbm93Zmxha2UudXBkYXRlKCk7CiAgICBzbm93Zmxha2UuZHJhdygpOwogIH0pOwogIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKfQoKLy8gU3RhcnQgYW5pbWF0aW9uCmFuaW1hdGUoKTs
