(async function loadBackgroundSettings() {
    const settingsUrl = "https://api.github.com/repos/YourRepo/YourSettingsFile/contents/settings.json"; // Replace with your settings URL

    // Default styles as fallback
    const defaultStyles = {
        backgroundImage: "https://www.example.com/default-background.jpg", // Replace with your default background
        backgroundColor: "#f9f9f9",
        textColor: "#000"
    };

    try {
        // Fetch the settings file
        const response = await fetch(settingsUrl);
        if (!response.ok) throw new Error(`Failed to fetch settings. Status: ${response.status}`);

        // Decode the Base64 content of the settings file
        const data = await response.json();
        const decodedSettings = atob(data.content);
        const settings = JSON.parse(decodedSettings);

        // Apply styles dynamically
        document.body.style.backgroundImage = `url(${settings.backgroundImage || defaultStyles.backgroundImage})`;
        document.body.style.backgroundColor = settings.backgroundColor || defaultStyles.backgroundColor;
        document.body.style.color = settings.textColor || defaultStyles.textColor;

        console.log("Background settings loaded successfully.");
    } catch (error) {
        console.warn("Error loading settings. Applying default styles.", error);

        // Apply fallback styles
        document.body.style.backgroundImage = `url(${defaultStyles.backgroundImage})`;
        document.body.style.backgroundColor = defaultStyles.backgroundColor;
        document.body.style.color = defaultStyles.textColor;
    }
})();